<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tag生成器</title>
	<style>
        #output-container {
            display: flex;
            align-items: center;
            justify-content: left;
            position: relative;
        }

        .part {
            height: 23px;
        }

        .start-part {
            width: 19px; /* 前X个像素 */
            background: url('Add_Tag_L.png') no-repeat;
        }

        .middle-part {
            display: flex;
            align-items: center;
            justify-content: center;
            background: url('Add_Tag_M.png') repeat-x;
            width: 8px; /* 设置初始宽度 */
            min-width: 8px; /* 设置最小宽度为8px */
        }

        .end-part {
            width: 3px; /* 后Y个像素 */
            background: url('Add_Tag_R.png') no-repeat;
        }

        .text {
            font-size: 12px;
            color: black;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            white-space: nowrap;
            text-overflow: ellipsis; /* 超出部分显示省略号 */
            overflow: hidden; /* 隐藏溢出的文字 */
            max-width: 100%; /* 确保文本不会超出容器 */
            position: relative; /* 相对定位，使文本覆盖在背景图上 */
        }
	</style>
</head>
<body>
<h1>Tag生成器</h1>
<input type="text" id="inputText" placeholder="输入文字">
<button onclick="generateImage()">生成Tag</button>
<hr/>
<div id="output-container">
	<div class="part start-part"></div>
	<div class="part middle-part">
		<div class="text" id="text"></div>
	</div>
	<div class="part end-part"></div>
</div>
<br/>
<button onclick="saveImage()">保存图片</button>

<script>
    let generatedImage = null;


    window.addEventListener("load", () => {
        const middlePart = document.querySelector('.middle-part');
        middlePart.style.width = '8px'; // 设置初始宽度为8px
    });
    function generateImage() {
        const text = document.getElementById('inputText').value;
        const textElement = document.getElementById('text');
        textElement.textContent = text;

        // 调整中间部分的宽度以适应文本
        const textWidth = getTextWidth(textElement);
        const middlePart = document.querySelector('.middle-part');
        middlePart.style.width = (textWidth > 0 ? textWidth + 20 : 8) + 'px';// 根据文本宽度调整中间部分宽度，增加20px内边距

        // 将生成的图片保存为全局变量
        generatedImage = textWidth > 0 ? generateImageWithText(text) : null;
    }

    function getTextWidth(element) {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        context.font = window.getComputedStyle(element).font;
        return context.measureText(element.textContent).width;
    }

    function generateImageWithText(text) {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const textElement = document.getElementById('text');

        // 设置 canvas 尺寸
        canvas.width = textElement.offsetWidth;
        canvas.height = textElement.offsetHeight;

        // 绘制背景和文本
        context.fillStyle = 'white';
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.font = window.getComputedStyle(textElement).font;
        context.fillStyle = 'black';
        context.fillText(text, 0, canvas.height / 2);

        // 将 canvas 转换为图片
        return canvas.toDataURL("image/png");
    }

    function saveImage() {
        if (!generatedImage) {
            alert("请先生成图片！");
            return;
        }

        // 创建一个画布
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        // 设置画布尺寸
        canvas.width = 100; // 设置为需要的宽度
        canvas.height = 50; // 设置为需要的高度

        // 绘制背景和文本
        const imageObj = new Image();
        imageObj.onload = function() {
            context.drawImage(imageObj, 0, 0); // 将背景图片绘制到画布上
            const textImage = new Image();
            textImage.onload = function() {
                context.drawImage(textImage, 0, 0); // 将带有文字的图片绘制到画布上
                // 将画布内容作为图片保存
                const dataUrl = canvas.toDataURL("image/png");
                // 创建一个下载链接并触发点击事件
                const a = document.createElement('a');
                a.href = dataUrl;
                a.download = 'tag.png';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };
            textImage.src = generatedImage;
        };
        imageObj.src = 'background.png'; // 背景图片路径
    }

</script>
</body>
</html>
